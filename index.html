
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ë¦¬ìš´ì „ ì‹œë®¬ë ˆì´ì…˜ (í†µí•© ìµœì¢…)</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; text-align: center; margin: 0; padding: 0; }
        #game-container { background: #333; padding: 10px; margin: 20px auto; width: 90%; max-width: 400px; border-radius: 10px; }
        button { margin: 5px; padding: 10px; font-size: 14px; width: 90%; max-width: 300px; }
        img { max-width: 100%; height: auto; margin: 10px 0; }
        .status, #event-description, #rankingArea { margin: 5px 0; font-size: 14px; }
    
@keyframes bounceIn {
  0% { transform: scale(0.3); opacity: 0; }
  50% { transform: scale(1.05); opacity: 1; }
  70% { transform: scale(0.9); }
  100% { transform: scale(1); }
}
.event-animate {
  animation: bounceIn 0.6s ease-out;
}


.good-effect {
  box-shadow: 0 0 20px 5px limegreen;
  transition: box-shadow 0.5s ease-out;
}
.bad-effect {
  box-shadow: 0 0 20px 5px red;
  transition: box-shadow 0.5s ease-out;
}

</style>
</head>
<body>
    <div id="game-container">
        <h1>ëŒ€ë¦¬ìš´ì „ ì‹œë®¬ë ˆì´ì…˜</h1>
        <div id="character-select">
            <p>ìºë¦­í„° ì„ íƒ (ëŠ¥ë ¥ ì„¤ëª…):</p>
            <div id="char-buttons"></div>
        </div>
        <div id="game" style="display:none;">
        <div id="shop" style="margin: 20px 0;">
            <h3>ìƒì </h3>
            <button onclick="buyItem('ë°•ì¹´ìŠ¤')">ë°•ì¹´ìŠ¤ (20ë§Œì›)</button>
            <button onclick="buyItem('í•«ì‹ìŠ¤')">í•«ì‹ìŠ¤ (30ë§Œì›)</button>
            <button onclick="buyItem('ì „ë™íœ ')">ì „ë™íœ  (100ë§Œì›)</button>
            <button onclick="buyItem('ë„ë°•')">ë„ë°• (50ë§Œì›)</button>
        </div>
            <div class="status">ìºë¦­í„°: <span id="character"></span></div>
            <div class="status">ë§¤ì¶œ: <span id="revenue">0</span>ì›</div>
            <div class="status">í”¼ë¡œë„: <span id="fatigue">0</span>%</div>
            <div class="status">ëª©í‘œ: <span id="goal">100000</span>ì›</div>
            <div class="status">ì½œ ìˆ˜: <span id="turns">0</span></div>
            <img id="event-image" src="" alt="" style="display:none;">
            <div id="choices"></div>
        </div>
        

        <div id="rankingArea"></div>
    </div>

    <audio id="button-sound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
    <audio id="event-sound" src="https://www.soundjay.com/buttons/sounds/button-6.mp3"></audio>
    <audio id="end-sound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCxRz9AGs1ADcSDkXSRwpxQj6J6T5U0Rls",
            authDomain: "daeri-b48bb.firebaseapp.com",
            projectId: "daeri-b48bb",
            storageBucket: "daeri-b48bb.appspot.com",
            messagingSenderId: "354494373374",
            appId: "1:354494373374:web:6f204c79027ddc020974af"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const characters = [
            { name: 'ë¶€ì²œì˜¤ì •êµ¬', ability: 'í”¼ë¡œë„ -60% ì‹œì‘' },
            { name: 'ì „ì„¤ì˜ëŒ€ë¦¬', ability: 'ì•„ë¬´ì¼ ì—†ìŒ ì‹œ í”¼ë¡œë„ 50% ê°ì†Œ' },
            { name: 'ìˆŸê°€ë½', ability: 'ì‚¬ê³  ì‹œ í”¼ë¡œë„ 50% ê°ì†Œ' },
            { name: 'ë² ì»´', ability: 'íŒ ì´ë²¤íŠ¸ ì‹œ ì´ë§¤ì¶œ 10% ì¦ê°€' },
            { name: 'ë§ˆì¸ë“œì„¸ë¶„', ability: 'ë§ì¶¤ì½œ ì„ íƒ ì‹œë§ˆë‹¤ í”¼ë¡œë„ 2% í•˜ë½' },
            { name: 'ì¥ëŒ€ë¶•ì–´', ability: 'ì¥ê±°ë¦¬/ë§ì¶¤ì½œ ì„ íƒ ì‹œ ì´ë§¤ì¶œ 10% ì¦ê°€' },
            { name: 'ë¯¸í˜¸ì´ì£¼', ability: 'ì§„ìƒì†ë‹˜ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' },
            { name: 'ì˜¤í•„ìŠ¹ì½œì´ì•¼', ability: 'ì½œ ì„ íƒë§ˆë‹¤ ì´ë§¤ì¶œÂ·í”¼ë¡œë„ 5% ì¶”ê°€ ì¦ê°€' },
            { name: 'ëŒ€ë¶•ì´íƒ€ë§ˆ', ability: 'ê²½ìœ  ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' },
            { name: 'ëª»ë¨¹ì–´ë„ê³ ê³ ', ability: 'ë§¤ë„ˆì†ë‹˜ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' },
            { name: 'ë©”íƒ„ì‹œë¼ì†Œë‹ˆ', ability: 'ì‚¬ê³  ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' },
            { name: 'ëŒ€ê¹¨ê°•ê¹€í™ì‹', ability: 'ì½œì·¨ì†Œ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ í”¼ë¡œë„ 20% ê°ì†Œ' },
            { name: 'í”¼ì›…ì‹ ë§Œë³´ë©´ì§–ëŠ”ê°œ, ability: 'ì§„ìƒì†ë‹˜ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' },
            { name: 'ì •ì˜ì‚¬ì‹ ', ability: 'ì°©ë³€ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì´ë§¤ì¶œ 20% ì¦ê°€' }
        ];

        let selectedCharacter = '';

let proChance = 2;
let boostedEvent = false;

        let revenue = 0, fatigue = 0, goal = 100000, turns = 0;

        const choices = [
            { name: 'ì¥ê±°ë¦¬ì½œ', fatigue: 20, min: 50000, max: 200000 },
            { name: 'ë‹¨ê±°ë¦¬ì½œ', fatigue: 5, min: 10000, max: 30000 },
            { name: 'ë§ì¶¤ì½œ', fatigue: 9, min: 20000, max: 80000 },
            { name: 'ì¹´ì¹´ì˜¤', fatigue: 10, min: 20000, max: 80000 },
            { name: 'ë¡œì§€', fatigue: 10, min: 15000, max: 80000 },
            { name: 'í‹°ë§µ', fatigue: 7, min: 8000, max: 50000 },
            { name: 'ì½œë§ˆë„ˆ', fatigue: 10, min: 15000, max: 70000 }
        ];

        const events = [
            { name: 'íŒ', img: 'https://i.imgur.com/WFWoTZX.jpeg', effect: () => { revenue += 50000; fatigue -= 5; if (selectedCharacter === 'ë² ì»´') revenue *= 1.8; } },
            { name: 'ì§„ìƒì†ë‹˜', img: 'https://i.imgur.com/yaXRNVx.jpeg', effect: () => { fatigue += 20; if (['ë¯¸í˜¸ì´ì£¼', 'í”¼ì›…ì‹ ë§Œë³´ë©´ì§–ëŠ”ê°œ'].includes(selectedCharacter)) revenue *= 1.8; } },
            { name: 'ë§¤ë„ˆì†ë‹˜', img: 'https://i.imgur.com/VzLkotH.jpeg', effect: () => { fatigue -= 10; if (selectedCharacter === 'ëª»ë¨¹ì–´ë„ê³ ê³ ') revenue *= 1.9; } },
            { name: 'ì‚¬ê³ ', img: 'https://i.imgur.com/PhTKoAa.jpeg', effect: () => { fatigue += 30; revenue -= 300000; if (selectedCharacter === 'ìˆŸê°€ë½') fatigue *= 0.8; if (selectedCharacter === 'ë©”íƒ„ì‹œë¼ì†Œë‹ˆ') revenue *= 0.8; } },
            { name: 'ì½œì·¨ì†Œ', img: 'https://i.imgur.com/quMoFAr.jpeg', effect: () => { fatigue += 5; if (selectedCharacter === 'ëŒ€ê¹¨ê°•ê¹€í™ì‹') fatigue *= 1.8; } },
            { name: 'ì•„ë¬´ì¼ ì—†ìŒ', img: 'https://i.imgur.com/j5Zadsd.jpeg', effect: () => { if (selectedCharacter === 'ì „ì„¤ì˜ëŒ€ë¦¬') fatigue *= 0.8; } },
            { name: 'ê²½ìœ ', img: 'https://i.imgur.com/lDTp7kk.jpeg', effect: () => { let amount = Math.floor(Math.random() * 25000) + 5000; revenue += amount; if (selectedCharacter === 'ëŒ€ë¶•ì´íƒ€ë§ˆ') revenue *= 1.8; } },
            { name: 'ì°©ë³€', img: 'https://i.imgur.com/O3pdLMQ.jpeg', effect: () => { let amount = Math.floor(Math.random() * 25000) + 5000; revenue += amount; if (selectedCharacter === 'ì •ì˜ì‚¬ì‹ ') revenue *= 1.8; } }
        ];

        
function getRandomEvent() {
    if (boostedEvent) {
        boostedEvent = false;
        const goodEvents = events.filter(e => ['íŒ', 'ë§¤ë„ˆì†ë‹˜'].includes(e.name));
        return goodEvents[Math.floor(Math.random() * goodEvents.length)];
    } else {
        return events[Math.floor(Math.random() * events.length)];
    }
}


function playSound(id) {
            const audio = document.getElementById(id);
            if (audio) { audio.currentTime = 0; audio.play(); }
        }

        function selectCharacter(name) {
            selectedCharacter = name;
            document.getElementById('character').textContent = name;
            document.getElementById('character-select').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            if (name === 'ë¶€ì²œì˜¤ì •êµ¬') fatigue -= 60;
            updateDisplay();
            setupChoices();
        }

        function updateDisplay() {
            document.getElementById('revenue').textContent = Math.floor(revenue);
            document.getElementById('fatigue').textContent = Math.max(fatigue, 0);
            document.getElementById('goal').textContent = goal;
            document.getElementById('turns').textContent = turns;
        }

        function setupChoices() {
            const container = document.getElementById('choices');
            container.innerHTML = '';
            const randomChoices = choices.sort(() => 0.5 - Math.random()).slice(0, 4);
            
    const proBtn = document.createElement('button');
    proBtn.textContent = `í”„ë¡œ ë‹¨ë… ë°°ì •ê¶Œ ì‚¬ìš© (${proChance}íšŒ ë‚¨ìŒ)`;
    proBtn.onclick = () => {
        if (proChance > 0) {
            proChance--;
            boostedEvent = true;
            alert("ì´ë¡œìš´ ì´ë²¤íŠ¸ í™•ë¥ ì´ ì¦ê°€í–ˆìŠµë‹ˆë‹¤!");
            updateDisplay();
            proBtn.textContent = `í”„ë¡œ ë‹¨ë… ë°°ì •ê¶Œ ì‚¬ìš© (${proChance}íšŒ ë‚¨ìŒ)`;
        }
    };
    container.prepend(proBtn);

    randomChoices.forEach(choice => {
                const btn = document.createElement('button');
                btn.textContent = choice.name;
                btn.onclick = () => handleChoice(choice);
                container.appendChild(btn);
            });
        }

        async function handleChoice(choice) {
            playSound('button-sound');
            turns++;
            let actualRevenue = Math.floor(Math.random() * (choice.max - choice.min + 1)) + choice.min;
            revenue += actualRevenue;
            fatigue += choice.fatigue;

            if (selectedCharacter === 'ë§ˆì¸ë“œì„¸ë¶„' && choice.name === 'ë§ì¶¤ì½œ') {
                fatigue -= 4;
            }

            const event = getRandomEvent();
            event.effect();
            const imgEl = document.getElementById('event-image');
            imgEl.src = event.img;
            imgEl.classList.remove('event-animate');
            void imgEl.offsetWidth;
            imgEl.classList.add('event-animate');
            // ì´í™íŠ¸ íš¨ê³¼
            imgEl.classList.remove('good-effect', 'bad-effect');
            if (['íŒ', 'ë§¤ë„ˆì†ë‹˜'].includes(event.name)) {
                imgEl.classList.add('good-effect');
            } else if (['ì§„ìƒì†ë‹˜', 'ì‚¬ê³ ', 'ì½œì·¨ì†Œ'].includes(event.name)) {
                imgEl.classList.add('bad-effect');
            }

            imgEl.style.display = 'block';
            playSound('event-sound');

            alert(`ì´ë²¤íŠ¸: ${event.name}
í˜„ì¬ ë§¤ì¶œ: ${Math.floor(revenue)}ì›, í”¼ë¡œë„: ${Math.floor(fatigue)}%`);

            if (fatigue >= 100) {
                await endGame();
                return;
            } else if (revenue >= goal) {
                alert(`ëª©í‘œ ${goal}ì› ë‹¬ì„±! ë‹¤ìŒ ë¼ìš´ë“œë¡œ ê°‘ë‹ˆë‹¤.`);
                goal *= 2;
            }

            updateDisplay();
            setupChoices();
        }

        async function endGame() {
            playSound('end-sound');
            alert(`ê²Œì„ ì¢…ë£Œ! ìµœì¢… ë§¤ì¶œ: ${Math.floor(revenue)}ì›, ì´ ì½œ ìˆ˜: ${turns}`);
            const nickname = prompt(`ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œí•˜ë©´ ì¬ì‹œì‘ë©ë‹ˆë‹¤):`);
            if (nickname) {
                await addDoc(collection(db, "rankings"), {
                    player: nickname,
                    sales: revenue,
                    calls: turns,
                    timestamp: serverTimestamp()
                });
                await showRankings();
            }
            resetGame();
        }

        async function showRankings() {
            const area = document.getElementById('rankingArea');
            area.innerHTML = "<h2>ğŸ† ìƒìœ„ ë­í‚¹</h2>";
            const q = query(collection(db, "rankings"), orderBy("sales", "desc"), limit(5));
            const snapshot = await getDocs(q);
            snapshot.forEach((doc, idx) => {
                const data = doc.data();
                const p = document.createElement('p');
                p.textContent = `${idx + 1}ìœ„ - ${data.player}: ${data.sales}ì› (${data.calls}ì½œ)`;
                area.appendChild(p);
            });
        }

        function resetGame() {
            revenue = 0; fatigue = 0; goal = 100000; turns = 0; proChance = 2;
            document.getElementById('game').style.display = 'none';
            document.getElementById('character-select').style.display = 'block';
        }

        
window.buyItem = function(name) {
    switch(name) {
        case 'ë°•ì¹´ìŠ¤':
            if (revenue >= 200000) {
                revenue -= 200000;
                fatigue = Math.max(0, fatigue - (10 + Math.floor(Math.random() * 21)));
                alert("ë°•ì¹´ìŠ¤ë¥¼ ë§ˆì…¨ìŠµë‹ˆë‹¤. í”¼ë¡œë„ê°€ ì¤„ì—ˆìŠµë‹ˆë‹¤!");
            } else {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
            break;
        case 'í•«ì‹ìŠ¤':
            if (revenue >= 300000) {
                revenue -= 300000;
                const recovery = 20 + Math.floor(Math.random() * 41);
                fatigue = Math.max(0, fatigue - recovery);
                alert(`í•«ì‹ìŠ¤ë¥¼ ë§ˆì…¨ìŠµë‹ˆë‹¤. í”¼ë¡œë„ê°€ ${recovery}% ì¤„ì—ˆìŠµë‹ˆë‹¤!`);
            } else {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
            break;
        case 'ì „ë™íœ ':
            if (revenue >= 1000000) {
                revenue *= 2;
                fatigue = Math.max(0, fatigue - 90);
                alert("ì „ë™íœ ì„ íƒ€ê³  ë‹¤ë…€ì™”ìŠµë‹ˆë‹¤! ë§¤ì¶œì´ 2ë°°, í”¼ë¡œë„ í¬ê²Œ ê°ì†Œ!");
            } else {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
            break;
        case 'ë„ë°•':
            if (revenue >= 500000) {
                revenue -= 500000;
                const chance = Math.random();
                if (chance < 0.5) {
                    revenue *= 2;
                    alert("ë„ë°• ì„±ê³µ! ë§¤ì¶œì´ 2ë°°ë¡œ ì¦ê°€!");
                } else {
                    alert("ë„ë°• ì‹¤íŒ¨... ê²Œì„ ì˜¤ë²„.");
                    endGame();
                    return;
                }
            } else {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
            break;
    }
    updateDisplay();
}


window.onload = () => {
            const btns = document.getElementById('char-buttons');
            btns.innerHTML = '';
            characters.forEach(char => {
                const b = document.createElement('button');
                b.textContent = `${char.name}: ${char.ability}`;
                b.onclick = () => selectCharacter(char.name);
                btns.appendChild(b);
            });
        };
    </script>
</body>
</html>
