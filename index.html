
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ë¦¬ìš´ì „ ì‹œë®¬ë ˆì´ì…˜ + ë­í‚¹</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; text-align: center; margin: 0; padding: 0; }
        #game-container { background: white; padding: 10px; margin: 20px auto; width: 90%; max-width: 400px; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        .status { margin: 5px 0; font-size: 14px; }
        button { margin: 5px; padding: 10px; font-size: 14px; width: 90%; max-width: 300px; }
        #event-img { width: 90%; height: auto; margin-top: 10px; display: none; }
        .char-description { font-size: 12px; color: #333; margin-bottom: 10px; }
        #event-description { font-size: 13px; margin-top: 5px; color: #555; }
        #rankingArea { background: #fff; padding: 10px; margin: 10px auto; width: 90%; max-width: 400px; }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCxRz9AGs1ADcSDkXSRwpxQj6J6T5U0Rls",
            authDomain: "daeri-b48bb.firebaseapp.com",
            projectId: "daeri-b48bb",
            storageBucket: "daeri-b48bb.appspot.com",
            messagingSenderId: "354494373374",
            appId: "1:354494373374:web:6f204c79027ddc020974af"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const characters = [
            { name: 'ë°¤ì§€ê¸°', ability: 'í”¼ë¡œë„ -50% ì‹œì‘' },
            { name: 'ì „ì„¤ì˜ëŒ€ë¦¬', ability: 'ì•„ë¬´ì¼ ì—†ìŒ ì‹œ í”¼ë¡œë„ ì ˆë°˜' },
            { name: 'ìˆŸê°€ë½', ability: 'ì‚¬ê³  í™•ë¥  ê°ì†Œ' },
            { name: 'ë² ì»´', ability: 'íŒ 2ë°°' },
            { name: 'ë§ˆì¸ë“œì„¸ë¶„', ability: '10% í™•ë¥  í”¼ë¡œë„ ì´ˆê¸°í™”' },
            { name: 'ì¥ëŒ€ë¶•ì–´', ability: 'ì¥ê±°ë¦¬/ì¹´ì¹´ì˜¤/ë§ì¶¤ì½œ ë‹¤ìŒ 2ë°°' },
            { name: 'ë¯¸í˜¸ì´ì£¼', ability: 'ì§„ìƒì†ë‹˜ ë§¤ì¶œ 2ë°°' },
            { name: 'ì˜¤í•„ìŠ¹ì½”ë¦¬ì•„', ability: 'ë§¤ì¶œÂ·í”¼ë¡œë„ 1.5ë°°' },
            { name: 'ëŒ€ë¶•ì´íƒ€ë§ˆ', ability: 'ê²½ìœ  ë‹¤ìŒì½œ 2ë°°' },
            { name: 'ëŸ­í‚¤ë„¤ì˜¤', ability: 'ë§¤ë„ˆì†ë‹˜ ë‹¤ìŒì½œ 2ë°°' },
            { name: 'ë©”íƒ„ì‹œë¼ì†Œë‹ˆ', ability: 'ì‚¬ê³  í›„ ë‹¤ìŒì½œ 2ë°°' },
            { name: 'ëŒ€ê¹¨ê°•ê¹€í™ì‹', ability: 'ì½œì·¨ì†Œì‹œ í”¼ë¡œë„ ì ˆë°˜' }
        ];

        const events = [
            { name: 'íŒì„ ë°›ì•˜ë‹¤', description: 'í”¼ë¡œë„ ê°ì†Œ, ë§¤ì¶œ ì¦ê°€', img: 'https://i.imgur.com/WFWoTZX.jpeg' },
            { name: 'ì§„ìƒì†ë‹˜', description: 'í”¼ë¡œë„ í¬ê²Œ ì¦ê°€', img: 'https://i.imgur.com/yaXRNVx.jpeg' },
            { name: 'ë§¤ë„ˆì†ë‹˜', description: 'í”¼ë¡œë„ ê°ì†Œ', img: 'https://i.imgur.com/VzLkotH.jpeg' },
            { name: 'ì‚¬ê³ ë°œìƒ', description: 'í”¼ë¡œë„ ì¦ê°€, ë§¤ì¶œ ê°ì†Œ', img: 'https://i.imgur.com/PhTKoAa.jpeg' },
            { name: 'ì½œì·¨ì†Œ', description: 'í”¼ë¡œë„ ì†Œí­ ì¦ê°€', img: 'https://i.imgur.com/quMoFAr.jpeg' },
            { name: 'ì•„ë¬´ì¼ ì—†ìŒ', description: 'ë³€í™” ì—†ìŒ', img: 'https://i.imgur.com/j5Zadsd.jpeg' },
            { name: 'ê²½ìœ ', description: 'ë§¤ì¶œ ì†Œí­ ì¦ê°€', img: 'https://i.imgur.com/lDTp7kk.jpeg' },
            { name: 'ì°©ë³€', description: 'ë§¤ì¶œ ì†Œí­ ì¦ê°€', img: 'https://i.imgur.com/O3pdLMQ.jpeg' },
            { name: 'ìˆŸê°€ë½ íšŒì› ë§Œë‚¨', description: 'í”¼ë¡œë„ í¬ê²Œ ê°ì†Œ', img: 'https://i.imgur.com/4dvrd8S.jpeg' }
        ];

        let selectedCharacter = '';
        let revenue = 0;
        let fatigue = 0;
        let goal = 100000;
        let turns = 0;

        window.selectCharacter = function(charName) {
            selectedCharacter = charName;
            document.getElementById('character').textContent = charName;
            document.getElementById('character-select').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            if (charName === 'ë°¤ì§€ê¸°') fatigue = -50;
            updateDisplay();
            setupChoices();
        }

        function updateDisplay() {
            document.getElementById('revenue').textContent = revenue;
            document.getElementById('fatigue').textContent = Math.max(fatigue, 0);
            document.getElementById('goal').textContent = goal;
            document.getElementById('turns').textContent = turns;
        }

        function setupChoices() {
            const container = document.getElementById('choices');
            container.innerHTML = '';
            const shuffled = choices.sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, Math.floor(Math.random() * 2) + 3);
            selected.forEach(choice => {
                const btn = document.createElement('button');
                btn.textContent = choice.name;
                btn.onclick = () => handleChoice(choice);
                container.appendChild(btn);
            });
        }

        async function handleChoice(choice) {
            turns++;
            let actualFatigue = choice.fatigue;
            let actualRevenue = Math.floor(Math.random() * (choice.max - choice.min + 1)) + choice.min;
            revenue += actualRevenue;
            fatigue += actualFatigue;

            const event = events[Math.floor(Math.random() * events.length)];
            document.getElementById('event-img').src = event.img;
            document.getElementById('event-img').style.display = 'block';
            document.getElementById('event-description').textContent = `${event.name}: ${event.description}`;

            if (fatigue >= 100) {
                await endGame();
            } else if (revenue >= goal) {
                alert(`ëª©í‘œ ${goal}ì› ë‹¬ì„±! ë‹¤ìŒ ë¼ìš´ë“œë¡œ ê°‘ë‹ˆë‹¤.`);
                goal *= 2;
            }

            updateDisplay();
            setupChoices();
        }

        async function endGame() {
            alert(`ê²Œì„ ì¢…ë£Œ! ì´ ì½œ ìˆ˜: ${turns}, ìµœì¢… ë§¤ì¶œ: ${revenue}ì›`);
            const name = prompt("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:");
            if (name) {
                await addDoc(collection(db, "rankings"), {
                    player: name,
                    sales: revenue,
                    calls: turns,
                    timestamp: new Date()
                });
                showRankings();
            }
            resetGame();
        }

        async function showRankings() {
            const area = document.getElementById('rankingArea');
            area.innerHTML = "<h2>ğŸ† ìƒìœ„ ë­í‚¹</h2>";
            const q = query(collection(db, "rankings"), orderBy("sales", "desc"), limit(5));
            const snapshot = await getDocs(q);
            snapshot.forEach((doc, idx) => {
                const data = doc.data();
                const p = document.createElement('p');
                p.textContent = `${idx + 1}ìœ„ - ${data.player}: ${data.sales}ì› (${data.calls}ì½œ)`;
                area.appendChild(p);
            });
        }

        function resetGame() {
            revenue = 0;
            fatigue = 0;
            goal = 100000;
            turns = 0;
            document.getElementById('game').style.display = 'none';
            document.getElementById('character-select').style.display = 'block';
        }

        const choices = [
            { name: 'ì¥ê±°ë¦¬ì½œ', fatigue: 20, min: 50000, max: 100000 },
            { name: 'ë‹¨ê±°ë¦¬ì½œ', fatigue: 5, min: 10000, max: 20000 },
            { name: 'ë§ì¶¤ì½œ', fatigue: 5, min: 20000, max: 40000 },
            { name: 'ì¹´ì¹´ì˜¤', fatigue: 15, min: 20000, max: 60000 },
            { name: 'ë¡œì§€', fatigue: 15, min: 10000, max: 80000 },
            { name: 'í‹°ë§µ', fatigue: 15, min: 8000, max: 40000 },
            { name: 'ì½œë§ˆë„ˆ', fatigue: 15, min: 15000, max: 70000 }
        ];

        function loadCharacterButtons() {
            const container = document.getElementById('char-buttons');
            characters.forEach(char => {
                const div = document.createElement('div');
                div.innerHTML = `<button onclick="selectCharacter('${char.name}')">${char.name}</button>
                                 <div class="char-description">${char.ability}</div>`;
                container.appendChild(div);
            });
        }

        loadCharacterButtons();
    </script>
</head>
<body>
    <div id="game-container">
        <h1>ëŒ€ë¦¬ìš´ì „ ì‹œë®¬ë ˆì´ì…˜</h1>
        <div id="character-select">
            <p>ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”:</p>
            <div id="char-buttons"></div>
        </div>
        <div id="game" style="display:none;">
            <div class="status">ì„ íƒëœ ìºë¦­í„°: <span id="character"></span></div>
            <div class="status">ë§¤ì¶œ: <span id="revenue">0</span>ì›</div>
            <div class="status">í”¼ë¡œë„: <span id="fatigue">0</span>%</div>
            <div class="status">ëª©í‘œ: <span id="goal">100000</span>ì›</div>
            <div class="status">ì½œ ìˆ˜: <span id="turns">0</span></div>
            <div id="message">ëœë¤ ì½œì„ ì„ íƒí•˜ì„¸ìš”:</div>
            <div id="choices"></div>
            <img id="event-img" src="" alt="ì´ë²¤íŠ¸ ì´ë¯¸ì§€">
            <div id="event-description"></div>
        </div>
    </div>
    <div id="rankingArea"></div>
</body>
</html>
