
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대리운전 시뮬레이션 (랭킹 리셋 수정)</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; text-align: center; margin: 0; padding: 0; }
        #game-container { background: #333; padding: 10px; margin: 20px auto; width: 90%; max-width: 400px; border-radius: 10px; }
        button { margin: 5px; padding: 10px; font-size: 14px; width: 90%; max-width: 300px; }
        img { max-width: 100%; height: auto; margin: 10px 0; }
        .status, #event-description, #ranking { margin: 5px 0; font-size: 14px; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>대리운전 시뮬레이션</h1>
        <div id="character-select">
            <p>캐릭터 선택 (능력 설명):</p>
            <div id="char-buttons"></div>
        </div>
        <div id="game" style="display:none;">
            <div class="status">캐릭터: <span id="character"></span></div>
            <div class="status">매출: <span id="revenue">0</span>원</div>
            <div class="status">피로도: <span id="fatigue">0</span>%</div>
            <div class="status">목표: <span id="goal">100000</span>원</div>
            <div class="status">콜 수: <span id="turns">0</span></div>
            <div id="event-description"></div>
            <img id="event-image" src="" alt="" style="display:none;">
            <div id="choices"></div>
        </div>
        <div id="ranking" style="display:none;">
            <h2>랭킹</h2>
            <ul id="ranking-list"></ul>
            <button onclick="resetGame()">게임 재시작</button>
        </div>
    </div>

    <audio id="button-sound" src="https://www.soundjay.com/buttons/button-16.mp3"></audio>
    <audio id="event-sound" src="https://www.soundjay.com/buttons/button-09.mp3"></audio>
    <audio id="end-sound" src="https://www.soundjay.com/buttons/button-10.mp3"></audio>

    <script>
        const characters = [
            { name: '밤지기', ability: '피로도 -30% 시작' },
            { name: '전설의대리', ability: '아무일 없음 시 피로도 50% 감소' },
            { name: '숟가락', ability: '사고 시 피로도 50% 감소' },
            { name: '베컴', ability: '팁 이벤트 시 총매출 10% 증가' },
            { name: '마인드세분', ability: '맞춤콜 선택 시마다 피로도 2% 하락' },
            { name: '장대붕어', ability: '장거리/맞춤콜 선택 시 총매출 10% 증가' },
            { name: '미호이주', ability: '진상손님 이벤트 발생 시 총매출 20% 증가' },
            { name: '오필승콜이야', ability: '콜 선택마다 총매출·피로도 5% 추가 증가' },
            { name: '대붕이타마', ability: '경유 이벤트 발생 시 총매출 20% 증가' },
            { name: '럭키네오', ability: '매너손님 이벤트 발생 시 총매출 20% 증가' },
            { name: '메탄시라소니', ability: '사고 이벤트 발생 시 총매출 20% 증가' },
            { name: '대깨강김홍식', ability: '콜취소 이벤트 발생 시 피로도 20% 감소' },
            { name: '리정자', ability: '진상손님 이벤트 발생 시 총매출 20% 증가' },
            { name: '정의사신', ability: '착변 이벤트 발생 시 총매출 20% 증가' }
        ];
        let selectedCharacter = '';
        let revenue = 0, fatigue = 0, goal = 100000, turns = 0;

        const choices = [
            { name: '장거리콜', fatigue: 20, min: 50000, max: 100000 },
            { name: '단거리콜', fatigue: 5, min: 10000, max: 20000 },
            { name: '맞춤콜', fatigue: 5, min: 20000, max: 40000 },
            { name: '카카오', fatigue: 15, min: 20000, max: 60000 },
            { name: '로지', fatigue: 15, min: 10000, max: 80000 },
            { name: '티맵', fatigue: 15, min: 8000, max: 40000 },
            { name: '콜마너', fatigue: 15, min: 15000, max: 70000 }
        ];

        const events = [
            { name: '팁', img: 'https://i.imgur.com/WFWoTZX.jpeg', effect: () => { revenue += 5000; fatigue -= 5; if (selectedCharacter === '베컴') revenue *= 1.1; return '+5000원, 피로도 -5%'; } },
            { name: '진상손님', img: 'https://i.imgur.com/yaXRNVx.jpeg', effect: () => { fatigue += 20; if (['미호이주', '리정자'].includes(selectedCharacter)) revenue *= 1.2; return '피로도 +20%'; } },
            { name: '매너손님', img: 'https://i.imgur.com/VzLkotH.jpeg', effect: () => { fatigue -= 10; if (selectedCharacter === '럭키네오') revenue *= 1.2; return '피로도 -10%'; } },
            { name: '사고', img: 'https://i.imgur.com/PhTKoAa.jpeg', effect: () => { fatigue += 30; revenue -= 300000; if (selectedCharacter === '숟가락') fatigue *= 0.5; if (selectedCharacter === '메탄시라소니') revenue *= 1.2; return '-300,000원, 피로도 +30%'; } },
            { name: '콜취소', img: 'https://i.imgur.com/quMoFAr.jpeg', effect: () => { fatigue += 5; if (selectedCharacter === '대깨강김홍식') fatigue *= 0.8; return '피로도 +5%'; } },
            { name: '아무일 없음', img: 'https://i.imgur.com/j5Zadsd.jpeg', effect: () => { if (selectedCharacter === '전설의대리') fatigue *= 0.5; return '변화 없음'; } },
            { name: '경유', img: 'https://i.imgur.com/lDTp7kk.jpeg', effect: () => { let amount = Math.floor(Math.random() * 15000) + 5000; revenue += amount; if (selectedCharacter === '대붕이타마') revenue *= 1.2; return `+${amount}원`; } },
            { name: '착변', img: 'https://i.imgur.com/O3pdLMQ.jpeg', effect: () => { let amount = Math.floor(Math.random() * 15000) + 5000; revenue += amount; if (selectedCharacter === '정의사신') revenue *= 1.2; return `+${amount}원`; } }
        ];

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) { sound.currentTime = 0; sound.play(); }
        }

        function selectCharacter(name) {
            selectedCharacter = name;
            document.getElementById('character').textContent = name;
            document.getElementById('character-select').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            if (name === '밤지기') fatigue -= 30;
            updateDisplay();
            setupChoices();
        }

        function updateDisplay() {
            document.getElementById('revenue').textContent = Math.floor(revenue);
            document.getElementById('fatigue').textContent = Math.max(fatigue, 0);
            document.getElementById('goal').textContent = goal;
            document.getElementById('turns').textContent = turns;
        }

        function setupChoices() {
            const container = document.getElementById('choices');
            container.innerHTML = '';
            const randomChoices = choices.sort(() => 0.5 - Math.random()).slice(0, 4);
            randomChoices.forEach(choice => {
                const btn = document.createElement('button');
                btn.textContent = choice.name;
                btn.onclick = () => handleChoice(choice);
                container.appendChild(btn);
            });
        }

        function handleChoice(choice) {
            playSound('button-sound');
            turns++;
            let actualRevenue = Math.floor(Math.random() * (choice.max - choice.min + 1)) + choice.min;
            revenue += actualRevenue;
            fatigue += choice.fatigue;

            const event = events[Math.floor(Math.random() * events.length)];
            const eventResult = event.effect();
            document.getElementById('event-description').textContent = `${event.name} 발생!`;
            const imgEl = document.getElementById('event-image');
            imgEl.src = event.img;
            imgEl.style.display = 'block';

            if (selectedCharacter === '마인드세분' && choice.name === '맞춤콜') fatigue -= 2;
            if (selectedCharacter === '장대붕어' && (choice.name === '장거리콜' || choice.name === '맞춤콜')) revenue *= 1.1;
            if (selectedCharacter === '오필승콜이야') { revenue *= 1.05; fatigue *= 1.05; }

            alert(`이벤트 결과:
${event.name} → ${eventResult}
현재 매출: ${Math.floor(revenue)}원, 피로도: ${Math.max(fatigue, 0)}%`);
            playSound('event-sound');

            if (fatigue >= 100) {
                endGame();
                return;
            } else if (revenue >= goal) {
                alert(`목표 ${goal}원 달성! 다음 라운드로 갑니다.`);
                goal *= 2;
            }

            updateDisplay();
            setupChoices();
        }

        function endGame() {
            playSound('end-sound');
            alert(`게임 종료! 최종 매출: ${Math.floor(revenue)}원, 총 콜 수: ${turns}`);
            const nickname = prompt(`닉네임을 입력하세요 (취소하면 재시작됩니다):`);
            if (nickname) {
                const ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
                ranking.push({ name: nickname, score: revenue });
                ranking.sort((a, b) => b.score - a.score);
                localStorage.setItem('ranking', JSON.stringify(ranking));
                showRanking(ranking);
            } else {
                resetGame();
            }
        }

        function showRanking(ranking) {
            document.getElementById('game').style.display = 'none';
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            ranking.slice(0, 10).forEach(entry => {
                const li = document.createElement('li');
                li.textContent = `${entry.name}: ${Math.floor(entry.score)}원`;
                list.appendChild(li);
            });
            document.getElementById('ranking').style.display = 'block';
        }

        function resetGame() {
            revenue = 0; fatigue = 0; goal = 100000; turns = 0;
            document.getElementById('ranking').style.display = 'none';
            document.getElementById('game').style.display = 'none';
            document.getElementById('character-select').style.display = 'block';
        }

        window.onload = () => {
            const btns = document.getElementById('char-buttons');
            btns.innerHTML = '';
            characters.forEach(char => {
                const b = document.createElement('button');
                b.textContent = `${char.name}: ${char.ability}`;
                b.onclick = () => selectCharacter(char.name);
                btns.appendChild(b);
            });
        };
    </script>
</body>
</html>
